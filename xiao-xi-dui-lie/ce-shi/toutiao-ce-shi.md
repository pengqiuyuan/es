**POST 请求写入数据到 **`kafka`

`POST` `http://127.0.0.1/api/v1/pa`

`HEADERS`：`"Content-Type" => "application/json"`

`BODY` 体参数说明：

```
index_name：索引名称（字符串）
type_name：分片名称（字符串）
index_message：消息体（数组、集合），消息体内的每一个对象都有 id（字符串）、index_name、 type_name 参数。
```

```js
{
  "index_name": "toutiao_articles_and_users",
  "type_name": "toutiao_articles_and_users",
  "index_message": [
    {
      "id": "10",
      "index_name": "toutiao_articles_and_users",
      "type_name": "toutiao_articles_and_users",
      "avatar_img": "http://p3.pstatp.com/thumb/6427/6955928713",
      "name": "乒乓网",
      "images": [
        "http://p3.pstatp.com/large/1b87000499c175535405",
        "http://p3.pstatp.com/large/1c5b00008e4599b81b91",
        "http://p3.pstatp.com/large/1b8100061f82797d4f60"
      ],
      "labels": [
        "张继科",
        "刘国梁",
        "许昕",
        "乒乓球"
      ],
      "crawled_at": 1492417059864,
      "up_count": 0,
      "fans_count": "33272",
      "toutiaor_id": "4725463253",
      "type": 0,
      "comment_count": 31,
      "follower_count": "4",
      "content": "林高远搭档樊振东获得2017亚锦赛男双冠军之后，休息了不长的时间，就再次参加男子单打比赛。他的对手，是大满贯人气王张继科。 这场比赛是四分之一决赛，位于男单下半区。 上半区马龙负于韩国郑尚恩，许昕输给日本丹羽孝希，已经失守。下半区还有林高远、张继科、樊振东。 林高远是从深圳直通赛杀出的小黑马，刘国梁在直通闭幕式上公开宣布要重点培养的球员，携刚获得的男双冠军之气势，不可小觑。 张继科近来一直受到伤病的困扰，在卡塔尔公开赛和地表12强直通赛，都因伤中途退赛。曾经的帝国绝凶虎，受伤病困扰令人担心。 在今天与林高远的比赛中，张继科犹如猛虎下山，开局气势如虹，11比7先声夺人。 第二局林高远调整过来，与张继科缠斗，以6比11扳回一局。 第三局上半程张继科继续发挥强大的反手霸王拧，林高远主要还是靠控球摆短再反攻，将比分战至7平8平。张继科10比8那个球，发球之后侧身爆拉，帅呆了。林高远也是大心脏，追回到10平。张继科以12:10再赢一局。 此局结束的局间，张继科在场边给脚部喷药绑扎绷带。观众席上的继科球迷，十分关注他的伤势，还有迷妹在心痛抹泪。 血性的藏獒在回归，年轻的林高远能否顶住？ 第四局比分纠缠上升，张继科的侧旋发球，让林高远频频失误或者回球质量不高。 7比6林高远发球疑似擦网，继科提出疑议说林高远自己都愣了一下，但裁判认为林高远发球有效。 受此影响比赛节奏有些变化，林高远把握机会，以11比7获得此局胜利。 进入决胜的第五局，老将与新秀，一开战就是大开大合火星四溅。 2比2时林高远爆挑十分果断精彩。 5比5林高远又吃发球了，张继科多变的发球给他很大困扰，基本每局都有吃发球。 下半程张继科林高远都不时发出大吼，杀得日月无光。张继科11比7获得最终胜利。 王者归来，张继科，好样的。 乒乓网 胡清源",
      "read_count": 20141,
      "title": "亚锦赛张继科大战林高远王者归来，怒吼猛于虎！",
      "down_count": 0,
      "duration": 0,
      "published_at": 1492261704000,
      "introduction": "乒乓网-我国最专业的乒乓球教学资讯网站！"
    },
    {
      "id": "11",
      "index_name": "toutiao_articles_and_users",
      "type_name": "toutiao_articles_and_users",
      "avatar_img": "http://p3.pstatp.com/thumb/6427/6955928713",
      "name": "乒乓网",
      "images": [
        "http://p3.pstatp.com/large/1b87000499c175535405",
        "http://p3.pstatp.com/large/1c5b00008e4599b81b91",
        "http://p3.pstatp.com/large/1b8100061f82797d4f60"
      ],
      "labels": [
        "张继科",
        "刘国梁",
        "许昕",
        "乒乓球"
      ],
      "crawled_at": 1492417059864,
      "up_count": 0,
      "fans_count": "33272",
      "toutiaor_id": "4725463253",
      "type": 0,
      "comment_count": 31,
      "follower_count": "4",
      "content": "林高远搭档樊振东获得2017亚锦赛男双冠军之后，休息了不长的时间，就再次参加男子单打比赛。他的对手，是大满贯人气王张继科。 这场比赛是四分之一决赛，位于男单下半区。 上半区马龙负于韩国郑尚恩，许昕输给日本丹羽孝希，已经失守。下半区还有林高远、张继科、樊振东。 林高远是从深圳直通赛杀出的小黑马，刘国梁在直通闭幕式上公开宣布要重点培养的球员，携刚获得的男双冠军之气势，不可小觑。 张继科近来一直受到伤病的困扰，在卡塔尔公开赛和地表12强直通赛，都因伤中途退赛。曾经的帝国绝凶虎，受伤病困扰令人担心。 在今天与林高远的比赛中，张继科犹如猛虎下山，开局气势如虹，11比7先声夺人。 第二局林高远调整过来，与张继科缠斗，以6比11扳回一局。 第三局上半程张继科继续发挥强大的反手霸王拧，林高远主要还是靠控球摆短再反攻，将比分战至7平8平。张继科10比8那个球，发球之后侧身爆拉，帅呆了。林高远也是大心脏，追回到10平。张继科以12:10再赢一局。 此局结束的局间，张继科在场边给脚部喷药绑扎绷带。观众席上的继科球迷，十分关注他的伤势，还有迷妹在心痛抹泪。 血性的藏獒在回归，年轻的林高远能否顶住？ 第四局比分纠缠上升，张继科的侧旋发球，让林高远频频失误或者回球质量不高。 7比6林高远发球疑似擦网，继科提出疑议说林高远自己都愣了一下，但裁判认为林高远发球有效。 受此影响比赛节奏有些变化，林高远把握机会，以11比7获得此局胜利。 进入决胜的第五局，老将与新秀，一开战就是大开大合火星四溅。 2比2时林高远爆挑十分果断精彩。 5比5林高远又吃发球了，张继科多变的发球给他很大困扰，基本每局都有吃发球。 下半程张继科林高远都不时发出大吼，杀得日月无光。张继科11比7获得最终胜利。 王者归来，张继科，好样的。 乒乓网 胡清源",
      "read_count": 20141,
      "title": "亚锦赛张继科大战林高远王者归来，怒吼猛于虎！",
      "down_count": 0,
      "duration": 0,
      "published_at": 1492261704000,
      "introduction": "乒乓网-我国最专业的乒乓球教学资讯网站！"
    }
  ]
}
```

`logstash`** 消费**`kafka`**中的数据到 **`elasticsearch`

```
input {
        kafka {
            bootstrap_servers => "127.0.0.1:9092"
            topics => ["weibo"]
            auto_offset_reset => "earliest"
            codec => "json"
        }
        kafka {
            bootstrap_servers => "127.0.0.1:9092"
            topics => ["weixin"]
            auto_offset_reset => "earliest"
            codec => "json"
        }
        kafka {
            bootstrap_servers => "127.0.0.1:9092"
            topics => ["toutiao"]
            auto_offset_reset => "earliest"
            codec => "json"
        }
        kafka {
            bootstrap_servers => "127.0.0.1:9092"
            topics => ["baidu"]
            auto_offset_reset => "earliest"
            codec => "json"
        }
        kafka {
            bootstrap_servers => "127.0.0.1:9092"
            topics => ["zhihu"]
            auto_offset_reset => "earliest"
            codec => "json"
        }
        kafka {
            bootstrap_servers => "127.0.0.1:9092"
            topics => ["kejizixun"]
            auto_offset_reset => "earliest"
            codec => "json"
        }
}
#filter {
#    mutate {
#         add_field => { "[@metadata][index_name]" => "test"}
#        add_field => { "[@metadata][type_name]" => "test"}
#         remove_field => ["headers","@timestamp","host","@version","message","index_message","index_name","type_name","id"]
#    }
#}
output {
        stdout {codec => rubydebug}
#        elasticsearch {
#            hosts => ["127.0.0.1:9222"]
#            index => "%{[@metadata][index_name]}"
#            workers => 1
#            document_type => "%{[@metadata][type_name]}"
#            template_overwrite => false
#        }
}
```

从队列中读取的数据，两条符合预期（`index_name`、`type_name`、`id`会在`logstash filter`中处理后保存数据到 `es`）

```
{
        "avatar_img" => "http://p3.pstatp.com/thumb/6427/6955928713",
     "comment_count" => 31,
         "type_name" => "toutiao_articles_and_users",
            "images" => [
        [0] "http://p3.pstatp.com/large/1b87000499c175535405",
        [1] "http://p3.pstatp.com/large/1c5b00008e4599b81b91",
        [2] "http://p3.pstatp.com/large/1b8100061f82797d4f60"
    ],
       "toutiaor_id" => "4725463253",
        "down_count" => 0,
          "up_count" => 0,
              "type" => 0,
             "title" => "亚锦赛张继科大战林高远王者归来，怒吼猛于虎！",
        "crawled_at" => 1492417059864,
    "follower_count" => "4",
           "content" => "林高远搭档樊振东获得2017亚锦赛男双冠军之后，休息了不长的时间，就再次参加男子单打比赛。他的对手，是大满贯人气王张继科。 这场比赛是四分之一决赛，位于男单下半区。 上半区马龙负于韩国郑尚恩，许昕输给日本丹羽孝希，已经失守。下半区还有林高远、张继科、樊振东。 林高远是从深圳直通赛杀出的小黑马，刘国梁在直通闭幕式上公开宣布要重点培养的球员，携刚获得的男双冠军之气势，不可小觑。 张继科近来一直受到伤病的困扰，在卡塔尔公开赛和地表12强直通赛，都因伤中途退赛。曾经的帝国绝凶虎，受伤病困扰令人担心。 在今天与林高远的比赛中，张继科犹如猛虎下山，开局气势如虹，11比7先声夺人。 第二局林高远调整过来，与张继科缠斗，以6比11扳回一局。 第三局上半程张继科继续发挥强大的反手霸王拧，林高远主要还是靠控球摆短再反攻，将比分战至7平8平。张继科10比8那个球，发球之后侧身爆拉，帅呆了。林高远也是大心脏，追回到10平。张继科以12:10再赢一局。 此局结束的局间，张继科在场边给脚部喷药绑扎绷带。观众席上的继科球迷，十分关注他的伤势，还有迷妹在心痛抹泪。 血性的藏獒在回归，年轻的林高远能否顶住？ 第四局比分纠缠上升，张继科的侧旋发球，让林高远频频失误或者回球质量不高。 7比6林高远发球疑似擦网，继科提出疑议说林高远自己都愣了一下，但裁判认为林高远发球有效。 受此影响比赛节奏有些变化，林高远把握机会，以11比7获得此局胜利。 进入决胜的第五局，老将与新秀，一开战就是大开大合火星四溅。 2比2时林高远爆挑十分果断精彩。 5比5林高远又吃发球了，张继科多变的发球给他很大困扰，基本每局都有吃发球。 下半程张继科林高远都不时发出大吼，杀得日月无光。张继科11比7获得最终胜利。 王者归来，张继科，好样的。 乒乓网 胡清源",
            "labels" => [
        [0] "张继科",
        [1] "刘国梁",
        [2] "许昕",
        [3] "乒乓球"
    ],
          "duration" => 0,
        "fans_count" => "33272",
        "@timestamp" => 2017-05-05T06:27:40.840Z,
              "name" => "乒乓网",
          "@version" => "1",
                "id" => "10",
      "published_at" => 1492261704000,
        "index_name" => "toutiao_articles_and_users",
      "introduction" => "乒乓网-我国最专业的乒乓球教学资讯网站！",
        "read_count" => 20141
}
{
        "avatar_img" => "http://p3.pstatp.com/thumb/6427/6955928713",
     "comment_count" => 31,
         "type_name" => "toutiao_articles_and_users",
            "images" => [
        [0] "http://p3.pstatp.com/large/1b87000499c175535405",
        [1] "http://p3.pstatp.com/large/1c5b00008e4599b81b91",
        [2] "http://p3.pstatp.com/large/1b8100061f82797d4f60"
    ],
       "toutiaor_id" => "4725463253",
        "down_count" => 0,
          "up_count" => 0,
              "type" => 0,
             "title" => "亚锦赛张继科大战林高远王者归来，怒吼猛于虎！",
        "crawled_at" => 1492417059864,
    "follower_count" => "4",
           "content" => "林高远搭档樊振东获得2017亚锦赛男双冠军之后，休息了不长的时间，就再次参加男子单打比赛。他的对手，是大满贯人气王张继科。 这场比赛是四分之一决赛，位于男单下半区。 上半区马龙负于韩国郑尚恩，许昕输给日本丹羽孝希，已经失守。下半区还有林高远、张继科、樊振东。 林高远是从深圳直通赛杀出的小黑马，刘国梁在直通闭幕式上公开宣布要重点培养的球员，携刚获得的男双冠军之气势，不可小觑。 张继科近来一直受到伤病的困扰，在卡塔尔公开赛和地表12强直通赛，都因伤中途退赛。曾经的帝国绝凶虎，受伤病困扰令人担心。 在今天与林高远的比赛中，张继科犹如猛虎下山，开局气势如虹，11比7先声夺人。 第二局林高远调整过来，与张继科缠斗，以6比11扳回一局。 第三局上半程张继科继续发挥强大的反手霸王拧，林高远主要还是靠控球摆短再反攻，将比分战至7平8平。张继科10比8那个球，发球之后侧身爆拉，帅呆了。林高远也是大心脏，追回到10平。张继科以12:10再赢一局。 此局结束的局间，张继科在场边给脚部喷药绑扎绷带。观众席上的继科球迷，十分关注他的伤势，还有迷妹在心痛抹泪。 血性的藏獒在回归，年轻的林高远能否顶住？ 第四局比分纠缠上升，张继科的侧旋发球，让林高远频频失误或者回球质量不高。 7比6林高远发球疑似擦网，继科提出疑议说林高远自己都愣了一下，但裁判认为林高远发球有效。 受此影响比赛节奏有些变化，林高远把握机会，以11比7获得此局胜利。 进入决胜的第五局，老将与新秀，一开战就是大开大合火星四溅。 2比2时林高远爆挑十分果断精彩。 5比5林高远又吃发球了，张继科多变的发球给他很大困扰，基本每局都有吃发球。 下半程张继科林高远都不时发出大吼，杀得日月无光。张继科11比7获得最终胜利。 王者归来，张继科，好样的。 乒乓网 胡清源",
            "labels" => [
        [0] "张继科",
        [1] "刘国梁",
        [2] "许昕",
        [3] "乒乓球"
    ],
          "duration" => 0,
        "fans_count" => "33272",
        "@timestamp" => 2017-05-05T06:27:40.840Z,
              "name" => "乒乓网",
          "@version" => "1",
                "id" => "11",
      "published_at" => 1492261704000,
        "index_name" => "toutiao_articles_and_users",
      "introduction" => "乒乓网-我国最专业的乒乓球教学资讯网站！",
        "read_count" => 20141
}
```



